+++
title = "Automating Geetest Captcha V3 Icon Analysis"
date = 2024-06-04T17:55:28+08:00
tags = ["tasteless"]
+++
![](../geetest-captcha-v3-icon.gif)
<!-- more -->

Geetest Captcha V3 Icon 是一种图像匹配验证码，用于区分人类和机器人。自动化这一过程比较简单，本文将大致介绍如何实现这一自动化过程。

## 总体思路

在手动通过验证码时，需要点击“验证”按钮，等待图片出现后按照提示的顺序依次点击图像，最后点击确认。在尝试自动化该过程时，可以模拟这一过程，点击按钮和获取图片可以通过 DrissionPage 控制浏览器实现，重点在于如何依次点击图像，即如何从图像中获取特征图形和位置并确定其顺序。

### 主要步骤

1. **模拟点击和获取图片**：使用 DrissionPage 控制浏览器。
2. **获取特征图形**：初步使用 DdddOcr 实现。
3. **确定点击顺序**：将特征图形进行匹配，可以使用图像分类模型实现。

在初步使用后发现效果不佳，DdddOcr 出现不少识别错误的情况，很多图像分类模型也不适合分类这些图形。因此，需要训练其他模型，其中 yolov9 是较新的特征提取模型，并且提供了简单的训练步骤。Siamese-pytorch 是一个孪生神经网络库，可进行图片相似性比较，虽然技术较旧且训练过程不易，但也是少有的可以比较图片相似性的模型。

## 训练 yolov9 模型

### 步骤 1：获取数据集

要获取验证码的图像较为容易，可以从网页元素中获取下载链接，也可以直接截图保存。

### 步骤 2：标注数据集

yolov9 项目推荐使用 Roboflow 进行数据集标注。Roboflow 可以对图像进行初步的特征标注，之后进行检查和修改即可。

### 步骤 3：训练模型

按照 yolov9 提供的教程下载数据集，并进行训练。具体步骤包括：
1. **准备环境**：安装所需的依赖。
2. **配置文件**：创建数据集的配置文件。
3. **开始训练**：运行训练脚本，监控训练过程。

## 训练 Siamese-pytorch 模型

### 步骤 1：获取数据集

此处需要先获取已经提取的特征图形，可以使用 DdddOcr 或 yolov9 模型提取特征图形。

### 步骤 2：标注数据集

手动将提取的特征图形进行分类。Siamese-pytorch 需要多组同类数据，为了方便，可以直接复制多份相同的图像。

### 步骤 3：训练模型

按照 Siamese-pytorch 提供的教程进行训练。为了方便使用，可以将其转换为 ONNX 格式，然后去除多余的初始化器。具体步骤包括：
1. **准备数据**：确保数据集格式符合模型要求。
2. **构建模型**：根据教程构建和配置模型。
3. **训练模型**：运行训练脚本，调整超参数以优化性能。
4. **模型转换**：将训练好的模型转换为 ONNX 格式，以便在不同环境中部署。
